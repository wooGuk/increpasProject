<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="board">

	<!-- 페이징 기법을 위한 전체 게시물의 수를 반환 select -->
	 	<select id="totalCount" resultType="int" parameterType="String">
		select count(*) from freeboard where bname = #{n}
	</select>

	<!-- 페이징 기법을 활용한 목록 select -->
	 <select id="list" resultType="mybatis.vo.FreeBoardVO" parameterType="java.util.Map">
		select * from (
		select rownum as r_num, a.* from (
		select * from freeboard where bname = #{bname} and status = 0
		order by groups DESC, lev ASC
		) a
		) where r_num between #{begin} and #{end}
	</select> 

	<!-- 원글 저장하기 -->
	<insert id="write" parameterType="mybatis.vo.FreeBoardVO">
		insert into freeboard(seq, title, content, hit, groups, step, lev, bname,
		regdate, uploadFileName, ip, status)
		values(freeboard_seq.NEXTVAL, #{title}, #{content}, 0, freeboard_group.NEXTVAL,
		0, 0, #{bname}, sysdate, #{uploadFileName},
		#{ip}, 0)
	</insert>


	<!-- 답변을 저장하기 전에 lev값 조정하기(참조글의 groups와 같고 참조글의 lev보다 큰 lev값을 1씩 증가시킨다. -->
	<!-- <update id="updateLev" parameterType="java.util.Map">
		update freeboard set lev = lev+1 where groups = #{groups} and lev &gt; #{lev}
	</update> -->


	<!-- 답변저장하는 insert -->
	<!-- <insert id="addAns" parameterType="mybatis.vo.FreeBoardVO">
		INSERT INTO FreeBoard(seq, title, content, hit, groups, step, lev, bname,
		regdate, uploadFileName, ip, status)
		VALUES(freeboard_seq.NEXTVAL,#{title}, #{content},0, #{groups}, #{step}, #{lev}, #{bname}, sysdate, 
		#{uploadFileName}, #{ip}, 0)
	</insert> -->

	<!-- 게시물 보기 기능을 위해 기본키로 검색하는 select -->
	<!-- <select id="getBbs" parameterType="String" resultType="mybatis.vo.FreeBoardVO">
		select *
		from FreeBoard
		where seq = #{seq}
	</select>
 -->

	<!-- 게시물을 수정하는 update(기본키와 비밀번호가 필요) -->
	 <!-- <update id="edit" parameterType="mybatis.vo.FreeBoardVO">
		update freeboard set
		title = #{title},
		content = #{content},
		regdate = sysdate
		<if test="uploadFileName != ''">
			,uploadFileName = #{uploadFileName}
		</if>
		where seq = #{seq} AND pwd = #{pwd}
	</update> -->

	 <!-- <update id="delBbs" parameterType="mybatis.vo.FreeBoardVO">
		UPDATE FreeBoard
		SET status = 1
		WHERE seq = #{seq} AND pwd = #{pwd}
	</update>  -->

</mapper>